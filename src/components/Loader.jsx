import React, { useEffect, forwardRef, useRef } from "react";
import { useProgress } from "@react-three/drei";
import anime from "animejs";
import { COLORS } from "../consts";

export default function Loader() {
  const { progress, errors } = useProgress();
  const ref = useRef();

  useEffect(() => {
    anime({
      targets: ref.current,
      strokeDashoffset: [anime.setDashoffset, 0],
      easing: "easeInOutSine",
      duration: 2500,
      delay: function (el, i) {
        return i * 250;
      },
      direction: "alternate",
      loop: true,
    });
  }, []);

  return (
    <div id="loader">
      {errors.length ? <h1>ERRORES</h1> : <BetonSVG ref={ref} />}
    </div>
  );
}

const BetonSVG = forwardRef((props, ref) => (
  <svg
    width="285.228"
    height="78.268"
    viewBox="0 0 285.228 78.268"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g
      id="svgGroup"
      strokeLinecap="round"
      fillRule="evenodd"
      fontSize="9pt"
      stroke="#000"
      strokeWidth="0.25mm"
      fill="none"
      style={{ stroke: "#000", strokeWidth: "0.25mm", fill: "none" }}
    >
      <path
        ref={ref}
        stroke={COLORS.primary}
        d="M 119.886 50 L 119.886 54.545 L 71.165 54.545 L 71.165 43.75 L 101.847 43.75 A 8.291 8.291 0 0 0 101.453 41.287 A 7.233 7.233 0 0 0 100.657 39.613 A 8.028 8.028 0 0 0 97.567 36.808 A 8.905 8.905 0 0 0 94.375 35.859 A 11.007 11.007 0 0 0 93.182 35.795 A 9.725 9.725 0 0 0 89.849 36.359 A 9.115 9.115 0 0 0 88.814 36.808 A 8.254 8.254 0 0 0 85.636 39.595 A 7.437 7.437 0 0 0 84.45 42.808 A 9.303 9.303 0 0 0 84.375 43.75 L 84.375 55.398 Q 84.375 58.026 85.476 60.085 Q 86.577 62.145 88.636 63.317 A 8.693 8.693 0 0 0 91.303 64.28 A 12.118 12.118 0 0 0 93.608 64.489 A 12.554 12.554 0 0 0 95.886 64.29 A 10.374 10.374 0 0 0 97.319 63.92 A 8.615 8.615 0 0 0 99.321 62.956 A 7.585 7.585 0 0 0 100.213 62.269 Q 101.42 61.186 101.989 59.659 L 119.886 59.659 A 20.879 20.879 0 0 1 117.341 66.903 A 19.653 19.653 0 0 1 115.518 69.513 A 21.386 21.386 0 0 1 109.123 74.703 A 26.751 26.751 0 0 1 106.41 75.977 Q 100.829 78.233 93.403 78.267 A 49.671 49.671 0 0 1 93.182 78.267 A 38.175 38.175 0 0 1 86.004 77.625 A 27.698 27.698 0 0 1 78.143 74.911 A 23.119 23.119 0 0 1 68.448 65.252 A 27.492 27.492 0 0 1 65.706 57.369 Q 65.059 54.008 65.057 50.172 A 45.272 45.272 0 0 1 65.057 50.142 A 35.513 35.513 0 0 1 65.806 42.687 A 27.447 27.447 0 0 1 68.466 35.369 A 24.363 24.363 0 0 1 78.089 25.533 A 26.721 26.721 0 0 1 86.97 22.471 A 35.477 35.477 0 0 1 92.756 22.017 A 34.406 34.406 0 0 1 99.163 22.591 A 27.787 27.787 0 0 1 103.942 23.935 A 23.664 23.664 0 0 1 111.936 28.934 A 22.936 22.936 0 0 1 112.5 29.492 A 24.206 24.206 0 0 1 117.33 36.734 A 28.505 28.505 0 0 1 117.969 38.317 Q 119.886 43.501 119.886 50 Z M 249.858 46.591 L 249.858 77.273 L 230.256 77.273 L 230.256 22.727 L 248.864 22.727 L 248.864 33.097 L 249.432 33.097 A 15.424 15.424 0 0 1 255.7 24.964 A 17.993 17.993 0 0 1 263.817 22.139 A 22.716 22.716 0 0 1 266.193 22.017 A 21.332 21.332 0 0 1 271.447 22.638 A 17.063 17.063 0 0 1 276.261 24.663 Q 280.54 27.308 282.901 31.925 Q 285.228 36.473 285.228 42.296 A 29.302 29.302 0 0 1 285.227 42.472 L 285.227 77.273 L 265.625 77.273 L 265.625 46.591 Q 265.661 42.543 263.583 40.234 A 6.804 6.804 0 0 0 259.66 38.089 A 10.005 10.005 0 0 0 257.812 37.926 A 9.424 9.424 0 0 0 255.685 38.156 A 7.406 7.406 0 0 0 253.604 38.974 A 6.928 6.928 0 0 0 250.852 41.957 A 9.127 9.127 0 0 0 250.094 44.228 Q 249.875 45.326 249.858 46.591 Z M 34.233 77.273 L 0 77.273 L 0 4.545 L 31.534 4.545 A 51.538 51.538 0 0 1 37.394 4.86 Q 41.968 5.384 45.508 6.783 A 22.502 22.502 0 0 1 49.794 8.999 A 16.283 16.283 0 0 1 54.066 13.104 A 15.716 15.716 0 0 1 56.875 20.866 A 19.874 19.874 0 0 1 56.96 22.727 Q 56.96 26.74 55.202 30.043 Q 53.445 33.345 50.284 35.565 A 18.522 18.522 0 0 1 44.944 38.125 A 22.47 22.47 0 0 1 42.898 38.636 L 42.898 39.347 A 18.785 18.785 0 0 1 49.45 40.742 A 17.727 17.727 0 0 1 51.42 41.708 A 16.503 16.503 0 0 1 57.528 47.71 A 16.012 16.012 0 0 1 59.579 53.588 A 20.798 20.798 0 0 1 59.801 56.676 A 19.503 19.503 0 0 1 58.587 63.62 A 18.114 18.114 0 0 1 56.694 67.294 A 19.992 19.992 0 0 1 50.406 73.252 A 25.258 25.258 0 0 1 47.869 74.609 A 27.34 27.34 0 0 1 41.173 76.688 Q 38.172 77.232 34.753 77.27 A 46.45 46.45 0 0 1 34.233 77.273 Z M 131.392 61.577 L 131.392 9.659 L 150.994 9.659 L 150.994 59.73 A 5.506 5.506 0 0 0 151.049 60.53 Q 151.141 61.153 151.385 61.63 A 2.456 2.456 0 0 0 152.592 62.766 A 3.692 3.692 0 0 0 153.332 63.008 Q 153.705 63.09 154.141 63.121 A 7.763 7.763 0 0 0 154.687 63.139 Q 155.415 63.139 156.345 62.996 A 17.3 17.3 0 0 0 156.765 62.926 A 60.241 60.241 0 0 0 157.321 62.824 Q 158.097 62.678 158.523 62.571 L 161.364 76.349 Q 160.358 76.649 158.696 77.052 A 129.908 129.908 0 0 1 157.617 77.308 A 26.06 26.06 0 0 1 155.337 77.728 Q 154.137 77.897 152.774 77.996 A 48.197 48.197 0 0 1 151.847 78.054 Q 145.708 78.377 141.362 76.951 A 18.155 18.155 0 0 1 140.518 76.651 A 14.771 14.771 0 0 1 136.533 74.405 A 12.596 12.596 0 0 1 133.629 71.094 A 14.698 14.698 0 0 1 131.882 66.668 Q 131.39 64.49 131.39 61.916 A 27.343 27.343 0 0 1 131.392 61.577 Z M 186.816 77.603 A 37.292 37.292 0 0 0 194.034 78.267 A 37.463 37.463 0 0 0 201.07 77.638 A 26.99 26.99 0 0 0 209.233 74.734 Q 215.554 71.2 218.928 64.862 A 27.691 27.691 0 0 0 221.484 57.897 A 35.251 35.251 0 0 0 222.301 50.142 A 36.949 36.949 0 0 0 221.903 44.622 A 28.469 28.469 0 0 0 218.928 35.423 Q 215.554 29.084 209.233 25.55 A 26.907 26.907 0 0 0 201.252 22.681 A 37.292 37.292 0 0 0 194.034 22.017 A 37.463 37.463 0 0 0 186.998 22.646 A 26.99 26.99 0 0 0 178.835 25.55 Q 172.514 29.084 169.141 35.423 A 27.691 27.691 0 0 0 166.584 42.387 A 35.251 35.251 0 0 0 165.767 50.142 A 36.949 36.949 0 0 0 166.166 55.662 A 28.469 28.469 0 0 0 169.141 64.862 Q 172.514 71.2 178.835 74.734 A 26.907 26.907 0 0 0 186.816 77.603 Z M 124.432 22.727 L 160.369 22.727 L 160.369 36.932 L 124.432 36.932 L 124.432 22.727 Z M 194.176 63.778 A 6.127 6.127 0 0 0 198.473 62.109 Q 200.284 60.44 201.278 57.351 A 19.323 19.323 0 0 0 201.984 54.254 Q 202.2 52.786 202.255 51.127 A 34.545 34.545 0 0 0 202.273 50 A 31.162 31.162 0 0 0 202.109 46.711 Q 201.869 44.455 201.278 42.631 A 14.319 14.319 0 0 0 200.418 40.525 Q 199.834 39.381 199.084 38.521 A 7.987 7.987 0 0 0 198.473 37.891 Q 196.662 36.222 194.176 36.222 A 6.566 6.566 0 0 0 189.666 37.891 Q 187.909 39.449 186.925 42.231 A 15.809 15.809 0 0 0 186.79 42.631 A 18.884 18.884 0 0 0 186.11 45.554 Q 185.795 47.583 185.795 50 Q 185.795 54.261 186.79 57.351 A 13.601 13.601 0 0 0 187.702 59.548 Q 188.341 60.754 189.18 61.639 A 7.858 7.858 0 0 0 189.666 62.109 A 6.566 6.566 0 0 0 194.176 63.778 Z M 200.426 15.909 L 187.5 15.909 L 194.318 0 L 211.08 0 L 200.426 15.909 Z M 19.744 46.165 L 19.744 61.506 L 28.977 61.506 A 21.401 21.401 0 0 0 31.577 61.358 Q 34.54 60.995 36.307 59.734 A 6.544 6.544 0 0 0 36.435 59.641 A 6.04 6.04 0 0 0 38.797 55.659 A 9.194 9.194 0 0 0 38.92 54.119 Q 38.92 51.563 37.749 49.787 A 7.131 7.131 0 0 0 35.076 47.397 A 8.866 8.866 0 0 0 34.428 47.088 Q 32.484 46.253 29.828 46.173 A 18.941 18.941 0 0 0 29.261 46.165 L 19.744 46.165 Z M 19.744 20.028 L 19.744 33.949 L 27.841 33.949 Q 30.433 33.949 32.422 33.132 A 7.785 7.785 0 0 0 34.241 32.096 A 6.468 6.468 0 0 0 35.529 30.771 A 5.811 5.811 0 0 0 36.544 28.288 A 7.826 7.826 0 0 0 36.648 26.989 Q 36.648 23.615 34.233 21.822 A 8.842 8.842 0 0 0 30.765 20.291 A 12.592 12.592 0 0 0 28.125 20.028 L 19.744 20.028 Z"
        vectorEffect="non-scaling-stroke"
      />
    </g>
  </svg>
));
